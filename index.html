<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level Data Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #dataOutput {
            white-space: pre-wrap; /* Preserve whitespace */
            border: 1px solid #ccc;
            padding: 10px;
            height: 300px;
            overflow-y: auto; /* Allow scrolling */
        }
    </style>
</head>
<body>

<h1>Level Data Output</h1>
<div id="dataOutput">Loading data...</div>

<button onclick="downloadData()">Download Level Data</button>

<script>
    var allData = [];
    var totalChunks = 0; // To be set when loading starts

    function addData(chunk) {
        allData.push(chunk);
        // Check if all chunks have been received
        if (allData.length === totalChunks) {
            // Display the complete data
            displayData(allData.join('')); // Join all chunks and display
        }
    }

    function displayData(data) {
        var outputElement = document.getElementById('dataOutput');
        outputElement.textContent = data; // Set the complete data as text content
    }

    function downloadData() {
        var blob = new Blob([allData.join('')], { type: 'text/plain' });
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'level_data.txt';
        link.click();
        URL.revokeObjectURL(link.href); // Clean up
    }

    // Check URL parameters for incoming data
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    window.onload = function() {
        var chunk = getUrlParameter('data');
        totalChunks = parseInt(getUrlParameter('total')); // Set the total chunks expected
        if (chunk) {
            addData(chunk);
        }
    };
</script>

</body>
</html>
